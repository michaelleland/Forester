<html>
	<head>
		<title>Owner receipt</title>
		<link rel="stylesheet" href="/stylesheets/reset.css" />
		<link rel="stylesheet" href="/stylesheets/text.css" />
		<link rel="stylesheet" href="/stylesheets/960.css" />
		<link rel="stylesheet" href="/stylesheets/style.css" />
		<link rel="stylesheet" href="/stylesheets/cupertino.css" />
		<%= javascript_include_tag :defaults %>
		<%= csrf_meta_tag %>
	</head>	
	<body>
		<div id="page">
			<div class="grid_10" id="landowner_payments">	
				<img src="/images/HFI_logo.png" id="hfi_logo"/>
				<div id="receipt_header">Landowner Payments</div>
				
				<div id="hfi_address_box">
					<div class="address_rows">10 South Parkway Avenue Suite 201</div>
					<div class="address_rows">Battle Ground, WA 98604</div>
					<div class="address_rows">Ph. 360-723-5523</div>
					<div class="address_rows">Fax. 360-723-5522</div>
				</div>
				
				<div id="details_box">
					<table>
						<tr>
							<td class="headers">Job name</td>
							<td class="table_data"><%= @job.name %></td>
						</tr>
						<tr>
							<td class="headers">Logger name</td>
							<td class="table_data"><%= @job.logger.name %></td>
						</tr>
						<tr>
							<td class="headers">Landowner details</td>
							<td class="table_data"><%= @job.owner.name %></td>
						</tr>
						<tr>
							<td></td>
							<td class="table_data"><%= @job.owner.address.street %></td>
						</tr>
						<tr>
							<td></td>
							<td class="table_data"><%= "#{@job.owner.address.city} #{$states[@job.owner.address.state]} #{@job.owner.address.zip_code}" %></td>
						</tr>
						
					</table>
				</div>
				
				<div id="job_items_box">
					<table>
						<tr>
							<th>Payment Number</th>
							<th>Date</th>
							<th></th>
							<th>Description</th>
							<th></th>
							<th style="text-align: right;">Amount</th>
						</tr>
						
						<% @payments.each do |i| %>
							<tr>
								<td><%= i.payment_num %></td>
								<td><%= i.payment_date %></td>
								<td></td>
								<td>Sawmill payment</td>
								<td></td>
								<% if @deduction_items.length == 0 && i == @payments.last %>
									<td style="text-align: right;"><div style="float: right; border-bottom: solid 1px black; width: 65px;"> + $ <%= i.total_payment %> </div></td>
								<% else %>
									<td style="text-align: right;"> + $ <%= i.total_payment %> </td>
								<% end %>
							</tr>
						<% end %>
						
						<% @deduction_items.each do |i| %>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td><%= i[0] %></td>
								<td></td>
								<% if i == @deduction_items.last %>
									<td style="text-align: right;"> <div style="float: right; border-bottom: solid 1px black; width: 65px;">- $ <%= i[1] %> </div></td>
								<% else %>
									<td style="text-align: right;"> - $ <%= i[1] %> </td>
								<% end %>
							</tr>
						<% end %>
												
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td class="tp">Total to be paid </td>
							<td class="to" style="text-align: right;">+ $ <%= @total %> </td>
						</tr>
			
					</table>
				</div>
			</div>
	</body>
</html>

<script>
function show_receipt_item_inputs () {
	$('#show_new_receipt_item_inputs').parent().before('<tr> <td></td><td></td><td></td><td><input type="text" name="item_data" id="item_data" size="10" /></td><td style="text-align: right;"><select name="polarity_selector" id="polarity_selector"><option value="1">+</option><option value="0">-</option></td><td><input style="float: left;" name="amount" id="amount" size="5" /> <div style="float: left; clear: none;" class="action_link" onclick="add_the_receipt_item();">Add</div></td></tr>')
	$('#show_new_receipt_item_inputs').fadeOut();	
}

function add_the_receipt_item () {
	$.ajax ({
		url: '/add_receipt_item',
		cache: false,
		success: function (html) {
			$('.all_entries_row').each(function () { $(this).remove()})
			$('#all_entries table').append(html);
		}
	})
}
	
</script>
